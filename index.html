<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FMHä»£å¸ç®¡ç†é¢æ¿ - Fomalhaut Token Management</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        body { 
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
            padding: 20px;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.98);
            border-radius: 24px;
            box-shadow: 0 32px 64px rgba(0,0,0,0.15);
            overflow: hidden;
            backdrop-filter: blur(10px);
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grid" width="10" height="10" patternUnits="userSpaceOnUse"><path d="M 10 0 L 0 0 0 10" fill="none" stroke="rgba(255,255,255,0.1)" stroke-width="0.5"/></pattern></defs><rect width="100" height="100" fill="url(%23grid)"/></svg>');
            opacity: 0.3;
        }
        
        .header h1 {
            font-size: 3em;
            margin-bottom: 12px;
            font-weight: 700;
            position: relative;
            z-index: 1;
        }
        
        .header p {
            opacity: 0.9;
            font-size: 1.2em;
            position: relative;
            z-index: 1;
        }
        
        .content {
            padding: 40px;
        }
        
        .wallet-section {
            text-align: center;
            padding: 40px;
            background: linear-gradient(135deg, #f8f9fd 0%, #e9ecef 100%);
            border-radius: 20px;
            margin-bottom: 40px;
            border: 1px solid #e9ecef;
        }
        
        .connect-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 16px 48px;
            border-radius: 50px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 24px rgba(102, 126, 234, 0.3);
        }
        
        .connect-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 32px rgba(102, 126, 234, 0.4);
        }
        
        .connect-btn:active {
            transform: translateY(0);
        }
        
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 30px;
            margin-top: 30px;
        }
        
        .card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 12px 24px rgba(0,0,0,0.1);
            border: 1px solid #f0f0f0;
            transition: all 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
        }
        
        .card h3 {
            color: #2c3e50;
            margin-bottom: 24px;
            font-size: 1.4em;
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 600;
        }
        
        .card-icon {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2em;
        }
        
        .icon-mint { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
        .icon-burn { background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); }
        .icon-permission { background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); }
        .icon-query { background: linear-gradient(135deg, #c3cfe2 0%, #c3cfe2 100%); }
        .icon-settings { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #374151;
        }
        
        .form-group input, .form-group select {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            font-size: 1em;
            transition: all 0.3s ease;
            background: #f9fafb;
        }
        
        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #667eea;
            background: white;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 14px 28px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: all 0.3s ease;
            width: 100%;
            margin-top: 12px;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }
        
        .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 6px 16px rgba(102, 126, 234, 0.4);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);
            box-shadow: 0 4px 12px rgba(255, 107, 107, 0.3);
        }
        
        .btn-danger:hover {
            box-shadow: 0 6px 16px rgba(255, 107, 107, 0.4);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #6c757d 0%, #5a6268 100%);
            box-shadow: 0 4px 12px rgba(108, 117, 125, 0.3);
        }
        
        .status {
            padding: 16px;
            border-radius: 12px;
            margin: 16px 0;
            font-weight: 500;
            border-left: 4px solid;
        }
        
        .status.success {
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
            color: #155724;
            border-color: #28a745;
        }
        
        .status.error {
            background: linear-gradient(135deg, #f8d7da 0%, #f1aeb5 100%);
            color: #721c24;
            border-color: #dc3545;
        }
        
        .status.info {
            background: linear-gradient(135deg, #d1ecf1 0%, #b8daff 100%);
            color: #0c5460;
            border-color: #17a2b8;
        }
        
        .status.warning {
            background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
            color: #856404;
            border-color: #ffc107;
        }
        
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 24px;
        }
        
        .info-item {
            background: linear-gradient(135deg, #f8f9fd 0%, #e9ecef 100%);
            padding: 24px;
            border-radius: 16px;
            text-align: center;
            border: 1px solid #e9ecef;
        }
        
        .info-item .value {
            font-size: 1.8em;
            font-weight: 700;
            color: #667eea;
            margin-bottom: 8px;
        }
        
        .info-item .label {
            color: #6b7280;
            font-size: 0.9em;
            font-weight: 500;
        }
        
        .hidden {
            display: none;
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .network-info {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            border: 1px solid #bbdefb;
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 24px;
            text-align: center;
            color: #1565c0;
            font-weight: 500;
        }
        
        .batch-section {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            border: 1px solid #e9ecef;
        }
        
        .batch-item {
            display: flex;
            gap: 12px;
            margin-bottom: 12px;
            align-items: center;
        }
        
        .batch-item input {
            flex: 1;
            padding: 10px 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        
        .batch-controls {
            display: flex;
            gap: 12px;
            margin-top: 16px;
        }
        
        .btn-small {
            padding: 8px 16px;
            font-size: 0.9em;
            width: auto;
            margin: 0;
        }
        
        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 16px;
            }
            
            .content {
                padding: 20px;
            }
            
            .grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .card {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸŒŸ FMHä»£å¸ç®¡ç†é¢æ¿</h1>
            <p>Fomalhaut Token Management Dashboard - ä¸“ä¸šçš„ä»£å¸ç®¡ç†å·¥å…·</p>
        </div>
        
        <div class="content">
            <div class="network-info">
                ğŸ“¡ <strong>ç½‘ç»œ:</strong> Monadæµ‹è¯•ç½‘ (Chain ID: 10143) | <strong>åˆçº¦åœ°å€:</strong> <span id="contractAddress">è¯·å…ˆè¿æ¥é’±åŒ…</span><br>
                <strong>ä¾èµ–çŠ¶æ€:</strong> <span id="ethersStatus">ğŸ”„ æ­£åœ¨åŠ è½½ä¾èµ–åº“...</span>
            </div>
            
            <div class="wallet-section">
                <div id="walletStatus">
                    <h2>ğŸ”Œ è¿æ¥é’±åŒ…å¼€å§‹ç®¡ç†</h2>
                    <p style="margin: 16px 0; color: #6b7280;">è¯·è¿æ¥æ‚¨çš„MetaMaské’±åŒ…ä»¥å¼€å§‹ä½¿ç”¨FMHä»£å¸ç®¡ç†åŠŸèƒ½</p>
                    <button class="connect-btn" onclick="connectWallet()">è¿æ¥MetaMaské’±åŒ…</button>
                </div>
            </div>
            
            <div id="mainPanel" class="hidden">
                <!-- åˆçº¦çŠ¶æ€æ¦‚è§ˆ -->
                <div class="card">
                    <h3>
                        <span class="card-icon icon-query">ğŸ“Š</span>
                        åˆçº¦çŠ¶æ€æ¦‚è§ˆ
                    </h3>
                    <button class="btn btn-secondary" onclick="refreshContractInfo()">ğŸ”„ åˆ·æ–°æ‰€æœ‰ä¿¡æ¯</button>
                    <div id="contractInfo"></div>
                </div>
                
                <div class="grid">
                    <!-- é“¸å¸é¢æ¿ -->
                    <div class="card">
                        <h3>
                            <span class="card-icon icon-mint">ğŸ­</span>
                            é“¸é€ ä»£å¸
                        </h3>
                        <div class="form-group">
                            <label>æ¥æ”¶åœ°å€:</label>
                            <input type="text" id="mintToAddress" placeholder="è¾“å…¥æ¥æ”¶ä»£å¸çš„é’±åŒ…åœ°å€ (0x...)">
                        </div>
                        <div class="form-group">
                            <label>é“¸é€ æ•°é‡:</label>
                            <input type="number" id="mintAmount" placeholder="è¾“å…¥é“¸é€ æ•°é‡" min="0" step="0.001">
                        </div>
                        <button class="btn" onclick="mintTokens()">ğŸ­ æ‰§è¡Œé“¸é€ </button>
                        <div id="mintStatus"></div>
                    </div>
                    
                    <!-- å•ç‹¬é”€æ¯é¢æ¿ -->
                    <div class="card">
                        <h3>
                            <span class="card-icon icon-burn">ğŸ”¥</span>
                            é”€æ¯ä»£å¸
                        </h3>
                        <div class="form-group">
                            <label>é”€æ¯æ–¹å¼:</label>
                            <select id="burnType" onchange="toggleBurnInputs()">
                                <option value="burn">é”€æ¯è‡ªå·±çš„ä»£å¸</option>
                                <option value="burnFrom">é”€æ¯ä»–äººçš„ä»£å¸</option>
                            </select>
                        </div>
                        <div class="form-group" id="burnFromGroup" style="display: none;">
                            <label>ç›®æ ‡åœ°å€:</label>
                            <input type="text" id="burnFromAddress" placeholder="è¾“å…¥è¦é”€æ¯ä»£å¸çš„åœ°å€">
                        </div>
                        <div class="form-group">
                            <label>é”€æ¯æ•°é‡:</label>
                            <input type="number" id="burnAmount" placeholder="è¾“å…¥é”€æ¯æ•°é‡" min="0" step="0.001">
                        </div>
                        <button class="btn btn-danger" onclick="burnTokens()">ğŸ”¥ æ‰§è¡Œé”€æ¯</button>
                        <div id="burnStatus"></div>
                    </div>
                    
                    <!-- æ‰¹é‡é”€æ¯é¢æ¿ -->
                    <div class="card">
                        <h3>
                            <span class="card-icon icon-burn">ğŸ”¥</span>
                            æ‰¹é‡é”€æ¯ä»£å¸
                        </h3>
                        <div class="batch-section">
                            <div id="batchBurnList">
                                <div class="batch-item">
                                    <input type="text" placeholder="åœ°å€ (0x...)" class="batch-address">
                                    <input type="number" placeholder="æ•°é‡" class="batch-amount" min="0" step="0.001">
                                    <button class="btn btn-danger btn-small" onclick="removeBatchItem(this)">åˆ é™¤</button>
                                </div>
                            </div>
                            <div class="batch-controls">
                                <button class="btn btn-secondary btn-small" onclick="addBatchItem()">â• æ·»åŠ é¡¹ç›®</button>
                                <button class="btn btn-danger btn-small" onclick="executeBatchBurn()">ğŸ”¥ æ‰¹é‡é”€æ¯</button>
                            </div>
                        </div>
                        <div id="batchBurnStatus"></div>
                    </div>
                    
                    <!-- æƒé™ç®¡ç†é¢æ¿ -->
                    <div class="card">
                        <h3>
                            <span class="card-icon icon-permission">ğŸ‘¥</span>
                            é“¸å¸æƒé™ç®¡ç†
                        </h3>
                        <div class="form-group">
                            <label>æ·»åŠ é“¸å¸è€…:</label>
                            <input type="text" id="newMinterAddress" placeholder="è¾“å…¥è¦æˆæƒçš„åœ°å€">
                            <button class="btn" onclick="addMinter()">â• æ·»åŠ é“¸å¸è€…</button>
                        </div>
                        
                        <div class="form-group">
                            <label>ç§»é™¤é“¸å¸è€…:</label>
                            <input type="text" id="removeMinterAddress" placeholder="è¾“å…¥è¦ç§»é™¤çš„åœ°å€">
                            <button class="btn btn-danger" onclick="removeMinter()">â– ç§»é™¤é“¸å¸è€…</button>
                        </div>
                        
                        <div class="form-group">
                            <label>æ£€æŸ¥æƒé™:</label>
                            <input type="text" id="checkMinterAddress" placeholder="è¾“å…¥è¦æ£€æŸ¥çš„åœ°å€">
                            <button class="btn btn-secondary" onclick="checkMinterPermission()">ğŸ” æ£€æŸ¥æƒé™</button>
                        </div>
                        
                        <div id="minterStatus"></div>
                    </div>
                    
                    <!-- ä»£å¸æŸ¥è¯¢é¢æ¿ -->
                    <div class="card">
                        <h3>
                            <span class="card-icon icon-query">ğŸ”</span>
                            ä»£å¸æŸ¥è¯¢
                        </h3>
                        <div class="form-group">
                            <label>æŸ¥è¯¢åœ°å€ä½™é¢:</label>
                            <input type="text" id="queryAddress" placeholder="è¾“å…¥è¦æŸ¥è¯¢çš„é’±åŒ…åœ°å€">
                            <button class="btn btn-secondary" onclick="queryBalance()">ğŸ’° æŸ¥è¯¢ä½™é¢</button>
                        </div>
                        
                        <div class="form-group">
                            <label>æŸ¥è¯¢é”€æ¯ç‡:</label>
                            <button class="btn btn-secondary" onclick="getBurnRate()">ğŸ“ˆ è·å–é”€æ¯ç‡</button>
                        </div>
                        
                        <div id="queryResults"></div>
                    </div>
                    
                    <!-- ç³»ç»Ÿè®¾ç½®é¢æ¿ -->
                    <div class="card">
                        <h3>
                            <span class="card-icon icon-settings">âš™ï¸</span>
                            ç³»ç»Ÿè®¾ç½®
                        </h3>
                        <div class="form-group">
                            <label>è®¾ç½®æ¸¸æˆåˆçº¦åœ°å€:</label>
                            <input type="text" id="gameContractAddress" placeholder="è¾“å…¥æ¸¸æˆåˆçº¦åœ°å€">
                            <button class="btn" onclick="setGameContract()">âš™ï¸ æ›´æ–°æ¸¸æˆåˆçº¦</button>
                        </div>
                        
                        <div class="form-group">
                            <label>å½“å‰æ¸¸æˆåˆçº¦:</label>
                            <button class="btn btn-secondary" onclick="getCurrentGameContract()">ğŸ® æŸ¥è¯¢å½“å‰æ¸¸æˆåˆçº¦</button>
                        </div>
                        
                        <div id="settingsStatus"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // å¤šCDNåŠ è½½ç­–ç•¥
        function loadEthers() {
            return new Promise((resolve, reject) => {
                const cdnUrls = [
                    'https://unpkg.com/ethers@5.7.2/dist/ethers.umd.min.js',
                    'https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js',
                    'https://cdn.skypack.dev/ethers@5.7.2',
                    'https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js'
                ];
                
                let currentIndex = 0;
                
                function tryLoad() {
                    if (currentIndex >= cdnUrls.length) {
                        reject(new Error('æ‰€æœ‰CDNéƒ½æ— æ³•åŠ è½½'));
                        return;
                    }
                    
                    const script = document.createElement('script');
                    script.src = cdnUrls[currentIndex];
                    script.onload = () => {
                        if (typeof ethers !== 'undefined') {
                            console.log(`âœ… Ethers.js ä» CDN${currentIndex + 1} åŠ è½½æˆåŠŸ`);
                            resolve();
                        } else {
                            currentIndex++;
                            tryLoad();
                        }
                    };
                    script.onerror = () => {
                        console.warn(`CDN${currentIndex + 1} åŠ è½½å¤±è´¥ï¼Œå°è¯•ä¸‹ä¸€ä¸ª...`);
                        currentIndex++;
                        tryLoad();
                    };
                    
                    // è®¾ç½®è¶…æ—¶
                    setTimeout(() => {
                        if (typeof ethers === 'undefined') {
                            script.remove();
                            currentIndex++;
                            tryLoad();
                        }
                    }, 5000);
                    
                    document.head.appendChild(script);
                }
                
                tryLoad();
            });
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåç«‹å³åŠ è½½ethers
        loadEthers().then(() => {
            console.log('âœ… Ethers.js åŠ è½½å®Œæˆ');
            document.getElementById('ethersStatus').innerHTML = 'âœ… ä¾èµ–åŠ è½½å®Œæˆ';
        }).catch(error => {
            console.error('âŒ Ethers.js åŠ è½½å¤±è´¥:', error);
            document.getElementById('ethersStatus').innerHTML = 'âŒ ç½‘ç»œè¿æ¥é—®é¢˜ï¼Œè¯·æ£€æŸ¥ç½‘ç»œååˆ·æ–°é¡µé¢';
        });
    </script>
    <script>
        // åˆçº¦é…ç½® - è¯·æ ¹æ®å®é™…éƒ¨ç½²åœ°å€ä¿®æ”¹
        let CONTRACT_ADDRESS = ""; // å°†åœ¨è¿æ¥é’±åŒ…åè®¾ç½®
        const MONAD_CHAIN_ID = "0x279F"; // 10143 in hex
        
        const CONTRACT_ABI = [
            // é“¸å¸å‡½æ•°
            "function mint(address to, uint256 amount) external",
            
            // é”€æ¯å‡½æ•°
            "function burn(uint256 amount) external",
            "function burnFrom(address from, uint256 amount) external",
            "function batchBurn(address[] calldata accounts, uint256[] calldata amounts) external",
            
            // æƒé™ç®¡ç†
            "function addAuthorizedMinter(address minter) external",
            "function removeAuthorizedMinter(address minter) external",
            "function isAuthorizedMinter(address minter) external view returns (bool)",
            "function isOwner(address addr) external view returns (bool)",
            
            // æŸ¥è¯¢å‡½æ•°
            "function totalSupply() external view returns (uint256)",
            "function getTotalBurned() external view returns (uint256)",
            "function getBurnRate() external view returns (uint256)",
            "function getRemainingSupply() external view returns (uint256)",
            "function getDailyMintRemaining() external view returns (uint256)",
            "function balanceOf(address account) external view returns (uint256)",
            "function name() external view returns (string)",
            "function symbol() external view returns (string)",
            "function decimals() external view returns (uint8)",
            
            // æ¸¸æˆåˆçº¦ç®¡ç†
            "function setMinesweeperGame(address _game) external",
            "function minesweeperGame() external view returns (address)",
            
            // å¸¸é‡
            "function MAX_SUPPLY() external view returns (uint256)",
            "function DAILY_MINT_LIMIT() external view returns (uint256)",
            "function SINGLE_MINT_LIMIT() external view returns (uint256)"
        ];
        
        let provider, signer, contract, userAddress;
        
        // è¿æ¥é’±åŒ…
        async function connectWallet() {
            try {
                // æ£€æŸ¥MetaMask
                if (typeof window.ethereum === 'undefined') {
                    showStatus('walletStatus', 'error', 'âŒ è¯·å…ˆå®‰è£…MetaMaské’±åŒ…æ‰©å±•<br><small>è®¿é—® <a href="https://metamask.io" target="_blank">metamask.io</a> ä¸‹è½½</small>');
                    return;
                }
                
                // ç­‰å¾…ethersåŠ è½½å®Œæˆ
                if (typeof ethers === 'undefined') {
                    showStatus('walletStatus', 'warning', 'â³ æ­£åœ¨åŠ è½½ä¾èµ–åº“ï¼Œè¯·ç¨å€™...');
                    
                    // æœ€å¤šç­‰å¾…30ç§’
                    let attempts = 0;
                    const maxAttempts = 60; // 30ç§’ï¼Œæ¯500msæ£€æŸ¥ä¸€æ¬¡
                    
                    const checkEthers = setInterval(() => {
                        attempts++;
                        if (typeof ethers !== 'undefined') {
                            clearInterval(checkEthers);
                            connectWallet(); // é€’å½’è°ƒç”¨
                        } else if (attempts >= maxAttempts) {
                            clearInterval(checkEthers);
                            showStatus('walletStatus', 'error', 'âŒ ä¾èµ–åŠ è½½è¶…æ—¶ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•<br><small>å¦‚æœé—®é¢˜æŒç»­å­˜åœ¨ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥</small>');
                        }
                    }, 500);
                    return;
                }
                
                showStatus('walletStatus', 'info', 'ğŸ”„ æ­£åœ¨è¿æ¥é’±åŒ…...');
                
                // è¯·æ±‚è¿æ¥è´¦æˆ·
                await window.ethereum.request({ method: 'eth_requestAccounts' });
                
                showStatus('walletStatus', 'info', 'ğŸ”„ æ£€æŸ¥ç½‘ç»œè®¾ç½®...');
                
                // æ£€æŸ¥å¹¶åˆ‡æ¢åˆ°Monadç½‘ç»œ
                const chainId = await window.ethereum.request({ method: 'eth_chainId' });
                if (chainId !== MONAD_CHAIN_ID) {
                    showStatus('walletStatus', 'warning', 'âš ï¸ éœ€è¦åˆ‡æ¢åˆ°Monadæµ‹è¯•ç½‘...');
                    try {
                        await window.ethereum.request({
                            method: 'wallet_switchEthereumChain',
                            params: [{ chainId: MONAD_CHAIN_ID }],
                        });
                    } catch (switchError) {
                        if (switchError.code === 4902) {
                            showStatus('walletStatus', 'info', 'ğŸ”„ æ­£åœ¨æ·»åŠ Monadæµ‹è¯•ç½‘...');
                            // æ·»åŠ Monadæµ‹è¯•ç½‘
                            await window.ethereum.request({
                                method: 'wallet_addEthereumChain',
                                params: [{
                                    chainId: MONAD_CHAIN_ID,
                                    chainName: 'Monad Testnet',
                                    nativeCurrency: {
                                        name: 'MON',
                                        symbol: 'MON',
                                        decimals: 18
                                    },
                                    rpcUrls: ['https://testnet-rpc.monad.xyz'],
                                    blockExplorerUrls: ['https://testnet-explorer.monad.xyz']
                                }]
                            });
                            showStatus('walletStatus', 'success', 'âœ… Monadæµ‹è¯•ç½‘æ·»åŠ æˆåŠŸ');
                        } else if (switchError.code === 4001) {
                            showStatus('walletStatus', 'error', 'âŒ ç”¨æˆ·æ‹’ç»åˆ‡æ¢ç½‘ç»œï¼Œè¯·æ‰‹åŠ¨åˆ‡æ¢åˆ°Monadæµ‹è¯•ç½‘');
                            return;
                        } else {
                            throw switchError;
                        }
                    }
                }
                
                provider = new ethers.providers.Web3Provider(window.ethereum);
                signer = provider.getSigner();
                userAddress = await signer.getAddress();
                
                showStatus('walletStatus', 'info', 'ğŸ”„ æ­£åœ¨è®¾ç½®åˆçº¦åœ°å€...');
                
                // æ™ºèƒ½åˆçº¦åœ°å€è¾“å…¥
                CONTRACT_ADDRESS = prompt(
                    'è¯·è¾“å…¥FMHä»£å¸åˆçº¦åœ°å€:\n\næç¤ºï¼šå¦‚æœæ˜¯ç¬¬ä¸€æ¬¡ä½¿ç”¨ï¼Œå¯ä»¥ä½¿ç”¨é»˜è®¤åœ°å€\næˆ–è€…è¾“å…¥æ‚¨è‡ªå·±çš„åˆçº¦åœ°å€', 
                    '0xFa32A01E4FDAde90204902EDfEa63C150407C736'
                );
                
                if (!CONTRACT_ADDRESS || CONTRACT_ADDRESS.trim() === '') {
                    showStatus('walletStatus', 'error', 'âŒ å¿…é¡»æä¾›æœ‰æ•ˆçš„åˆçº¦åœ°å€æ‰èƒ½ç»§ç»­');
                    return;
                }
                
                CONTRACT_ADDRESS = CONTRACT_ADDRESS.trim();
                
                // éªŒè¯åˆçº¦åœ°å€æ ¼å¼
                if (!ethers.utils.isAddress(CONTRACT_ADDRESS)) {
                    showStatus('walletStatus', 'error', 'âŒ åˆçº¦åœ°å€æ ¼å¼é”™è¯¯ï¼Œè¯·è¾“å…¥æœ‰æ•ˆçš„ä»¥å¤ªåŠåœ°å€');
                    return;
                }
                
                showStatus('walletStatus', 'info', 'ğŸ”„ æ­£åœ¨è¿æ¥åˆçº¦...');
                
                contract = new ethers.Contract(CONTRACT_ADDRESS, CONTRACT_ABI, signer);
                
                // æµ‹è¯•åˆçº¦è¿æ¥
                try {
                    const contractName = await contract.name();
                    console.log('âœ… åˆçº¦è¿æ¥æˆåŠŸ:', contractName);
                } catch (testError) {
                    showStatus('walletStatus', 'error', `âŒ åˆçº¦è¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥åˆçº¦åœ°å€æ˜¯å¦æ­£ç¡®<br><small>é”™è¯¯: ${testError.message}</small>`);
                    return;
                }
                
                showStatus('walletStatus', 'info', 'ğŸ”„ æ£€æŸ¥ç”¨æˆ·æƒé™...');
                
                // æ£€æŸ¥ç”¨æˆ·æƒé™
                const isOwner = await contract.isOwner(userAddress);
                const isMinter = await contract.isAuthorizedMinter(userAddress);
                
                if (!isOwner && !isMinter) {
                    document.getElementById('walletStatus').innerHTML = `
                        <div class="status warning">
                            âš ï¸ è¿æ¥æˆåŠŸï¼Œä½†æƒé™å—é™<br>
                            <strong>åœ°å€:</strong> ${userAddress}<br>
                            <strong>çŠ¶æ€:</strong> æ­¤åœ°å€æ²¡æœ‰Owneræˆ–é“¸å¸æƒé™<br>
                            <small>æŸäº›åŠŸèƒ½å¯èƒ½æ— æ³•ä½¿ç”¨</small>
                        </div>
                    `;
                } else {
                    document.getElementById('walletStatus').innerHTML = `
                        <div class="status success">
                            âœ… é’±åŒ…è¿æ¥æˆåŠŸ<br>
                            <strong>åœ°å€:</strong> ${userAddress}<br>
                            <strong>æƒé™:</strong> ${isOwner ? 'âœ… Owner' : ''} ${isMinter ? 'âœ… Minter' : ''}
                        </div>
                    `;
                }
                
                // æ›´æ–°åˆçº¦åœ°å€æ˜¾ç¤º
                document.getElementById('contractAddress').textContent = CONTRACT_ADDRESS;
                
                // æ˜¾ç¤ºä¸»é¢æ¿
                document.getElementById('mainPanel').classList.remove('hidden');
                
                // è‡ªåŠ¨åˆ·æ–°åˆçº¦ä¿¡æ¯
                await refreshContractInfo();
                
            } catch (error) {
                console.error('è¿æ¥å¤±è´¥:', error);
                showStatus('walletStatus', 'error', `âŒ è¿æ¥å¤±è´¥: ${error.message}`);
            }
        }
        
        // åˆ·æ–°åˆçº¦ä¿¡æ¯
        async function refreshContractInfo() {
            try {
                showLoading('contractInfo');
                
                const [
                    name, symbol, decimals, totalSupply, totalBurned, 
                    remainingSupply, dailyRemaining, maxSupply, 
                    dailyLimit, singleLimit, gameContract
                ] = await Promise.all([
                    contract.name(),
                    contract.symbol(),
                    contract.decimals(),
                    contract.totalSupply(),
                    contract.getTotalBurned(),
                    contract.getRemainingSupply(),
                    contract.getDailyMintRemaining(),
                    contract.MAX_SUPPLY(),
                    contract.DAILY_MINT_LIMIT(),
                    contract.SINGLE_MINT_LIMIT(),
                    contract.minesweeperGame()
                ]);
                
                const burnRate = await contract.getBurnRate();
                
                document.getElementById('contractInfo').innerHTML = `
                    <div class="info-grid">
                        <div class="info-item">
                            <div class="value">${name}</div>
                            <div class="label">ä»£å¸åç§°</div>
                        </div>
                        <div class="info-item">
                            <div class="value">${symbol}</div>
                            <div class="label">ä»£å¸ç¬¦å·</div>
                        </div>
                        <div class="info-item">
                            <div class="value">${formatToken(totalSupply)}</div>
                            <div class="label">æ€»ä¾›åº”é‡</div>
                        </div>
                        <div class="info-item">
                            <div class="value">${formatToken(totalBurned)}</div>
                            <div class="label">å·²é”€æ¯æ•°é‡</div>
                        </div>
                        <div class="info-item">
                            <div class="value">${(burnRate / 100).toFixed(2)}%</div>
                            <div class="label">é”€æ¯ç‡</div>
                        </div>
                        <div class="info-item">
                            <div class="value">${formatToken(remainingSupply)}</div>
                            <div class="label">å‰©ä½™å¯é“¸é€ </div>
                        </div>
                        <div class="info-item">
                            <div class="value">${formatToken(dailyRemaining)}</div>
                            <div class="label">ä»Šæ—¥å‰©ä½™é¢åº¦</div>
                        </div>
                        <div class="info-item">
                            <div class="value">${gameContract === '0x0000000000000000000000000000000000000000' ? 'æœªè®¾ç½®' : 'å·²è®¾ç½®'}</div>
                            <div class="label">æ¸¸æˆåˆçº¦çŠ¶æ€</div>
                        </div>
                    </div>
                `;
            } catch (error) {
                console.error('è·å–åˆçº¦ä¿¡æ¯å¤±è´¥:', error);
                showStatus('contractInfo', 'error', `âŒ è·å–åˆçº¦ä¿¡æ¯å¤±è´¥: ${error.message}`);
            }
        }
        
        // é“¸é€ ä»£å¸
        async function mintTokens() {
            try {
                const toAddress = document.getElementById('mintToAddress').value.trim();
                const amount = document.getElementById('mintAmount').value.trim();
                
                if (!toAddress || !amount) {
                    showStatus('mintStatus', 'error', 'âŒ è¯·å¡«å†™å®Œæ•´çš„é“¸å¸ä¿¡æ¯');
                    return;
                }
                
                if (!ethers.utils.isAddress(toAddress)) {
                    showStatus('mintStatus', 'error', 'âŒ æ¥æ”¶åœ°å€æ ¼å¼é”™è¯¯');
                    return;
                }
                
                if (parseFloat(amount) <= 0) {
                    showStatus('mintStatus', 'error', 'âŒ é“¸å¸æ•°é‡å¿…é¡»å¤§äº0');
                    return;
                }
                
                showStatus('mintStatus', 'info', 'â³ æ­£åœ¨å¤„ç†é“¸å¸äº¤æ˜“ï¼Œè¯·åœ¨é’±åŒ…ä¸­ç¡®è®¤...');
                
                const mintAmount = ethers.utils.parseEther(amount);
                const tx = await contract.mint(toAddress, mintAmount);
                
                showStatus('mintStatus', 'info', `â³ äº¤æ˜“å·²æäº¤ï¼Œç­‰å¾…ç¡®è®¤...<br><small>äº¤æ˜“å“ˆå¸Œ: ${tx.hash}</small>`);
                
                const receipt = await tx.wait();
                showStatus('mintStatus', 'success', `âœ… é“¸å¸æˆåŠŸï¼<br>å·²å‘ ${toAddress} é“¸é€  ${amount} FMH<br><small>Gasè´¹ç”¨: ${receipt.gasUsed.toString()}</small>`);
                
                // æ¸…ç©ºè¡¨å•å¹¶åˆ·æ–°ä¿¡æ¯
                document.getElementById('mintToAddress').value = '';
                document.getElementById('mintAmount').value = '';
                await refreshContractInfo();
                
            } catch (error) {
                console.error('é“¸å¸å¤±è´¥:', error);
                let errorMsg = 'âŒ é“¸å¸å¤±è´¥: ';
                if (error.message.includes('Exceeds single mint limit')) {
                    errorMsg += 'è¶…è¿‡å•æ¬¡é“¸å¸é™åˆ¶';
                } else if (error.message.includes('Exceeds daily mint limit')) {
                    errorMsg += 'è¶…è¿‡æ¯æ—¥é“¸å¸é™åˆ¶';
                } else if (error.message.includes('Exceeds maximum supply')) {
                    errorMsg += 'è¶…è¿‡æ€»ä¾›åº”é‡é™åˆ¶';
                } else if (error.message.includes('Not authorized')) {
                    errorMsg += 'æ²¡æœ‰é“¸å¸æƒé™';
                } else {
                    errorMsg += error.message;
                }
                showStatus('mintStatus', 'error', errorMsg);
            }
        }
        
        // åˆ‡æ¢é”€æ¯è¾“å…¥æ¡†
        function toggleBurnInputs() {
            const burnType = document.getElementById('burnType').value;
            const burnFromGroup = document.getElementById('burnFromGroup');
            
            if (burnType === 'burnFrom') {
                burnFromGroup.style.display = 'block';
            } else {
                burnFromGroup.style.display = 'none';
            }
        }
        
        // é”€æ¯ä»£å¸
        async function burnTokens() {
            try {
                const burnType = document.getElementById('burnType').value;
                const amount = document.getElementById('burnAmount').value.trim();
                
                if (!amount) {
                    showStatus('burnStatus', 'error', 'âŒ è¯·è¾“å…¥é”€æ¯æ•°é‡');
                    return;
                }
                
                if (parseFloat(amount) <= 0) {
                    showStatus('burnStatus', 'error', 'âŒ é”€æ¯æ•°é‡å¿…é¡»å¤§äº0');
                    return;
                }
                
                const burnAmount = ethers.utils.parseEther(amount);
                let tx;
                
                if (burnType === 'burn') {
                    // é”€æ¯è‡ªå·±çš„ä»£å¸
                    if (!confirm(`ç¡®è®¤è¦é”€æ¯æ‚¨çš„ ${amount} FMH ä»£å¸å—ï¼Ÿ\n\nâš ï¸ æ­¤æ“ä½œä¸å¯æ’¤é”€ï¼`)) {
                        return;
                    }
                    
                    showStatus('burnStatus', 'warning', 'â³ æ­£åœ¨é”€æ¯æ‚¨çš„ä»£å¸...');
                    tx = await contract.burn(burnAmount);
                    
                } else {
                    // é”€æ¯ä»–äººçš„ä»£å¸
                    const fromAddress = document.getElementById('burnFromAddress').value.trim();
                    
                    if (!fromAddress || !ethers.utils.isAddress(fromAddress)) {
                        showStatus('burnStatus', 'error', 'âŒ è¯·è¾“å…¥æœ‰æ•ˆçš„ç›®æ ‡åœ°å€');
                        return;
                    }
                    
                    if (!confirm(`ç¡®è®¤è¦é”€æ¯ ${fromAddress} çš„ ${amount} FMH ä»£å¸å—ï¼Ÿ\n\nâš ï¸ æ­¤æ“ä½œä¸å¯æ’¤é”€ï¼`)) {
                        return;
                    }
                    
                    showStatus('burnStatus', 'warning', 'â³ æ­£åœ¨é”€æ¯ç›®æ ‡åœ°å€çš„ä»£å¸...');
                    tx = await contract.burnFrom(fromAddress, burnAmount);
                }
                
                showStatus('burnStatus', 'info', `â³ äº¤æ˜“å·²æäº¤ï¼Œç­‰å¾…ç¡®è®¤...<br><small>äº¤æ˜“å“ˆå¸Œ: ${tx.hash}</small>`);
                
                await tx.wait();
                showStatus('burnStatus', 'success', `âœ… ä»£å¸é”€æ¯æˆåŠŸï¼<br>å·²é”€æ¯ ${amount} FMH`);
                
                // æ¸…ç©ºè¡¨å•å¹¶åˆ·æ–°ä¿¡æ¯
                document.getElementById('burnAmount').value = '';
                document.getElementById('burnFromAddress').value = '';
                await refreshContractInfo();
                
            } catch (error) {
                console.error('é”€æ¯å¤±è´¥:', error);
                let errorMsg = 'âŒ é”€æ¯å¤±è´¥: ';
                if (error.message.includes('Insufficient balance')) {
                    errorMsg += 'ä½™é¢ä¸è¶³';
                } else if (error.message.includes('Not authorized')) {
                    errorMsg += 'æ²¡æœ‰æƒé™æ‰§è¡Œæ­¤æ“ä½œ';
                } else {
                    errorMsg += error.message;
                }
                showStatus('burnStatus', 'error', errorMsg);
            }
        }
        
        // æ·»åŠ æ‰¹é‡é¡¹ç›®
        function addBatchItem() {
            const batchList = document.getElementById('batchBurnList');
            const newItem = document.createElement('div');
            newItem.className = 'batch-item';
            newItem.innerHTML = `
                <input type="text" placeholder="åœ°å€ (0x...)" class="batch-address">
                <input type="number" placeholder="æ•°é‡" class="batch-amount" min="0" step="0.001">
                <button class="btn btn-danger btn-small" onclick="removeBatchItem(this)">åˆ é™¤</button>
            `;
            batchList.appendChild(newItem);
        }
        
        // ç§»é™¤æ‰¹é‡é¡¹ç›®
        function removeBatchItem(button) {
            const batchList = document.getElementById('batchBurnList');
            if (batchList.children.length > 1) {
                button.parentElement.remove();
            } else {
                showStatus('batchBurnStatus', 'warning', 'âš ï¸ è‡³å°‘éœ€è¦ä¿ç•™ä¸€ä¸ªé¡¹ç›®');
            }
        }
        
        // æ‰§è¡Œæ‰¹é‡é”€æ¯
        async function executeBatchBurn() {
            try {
                const batchItems = document.querySelectorAll('.batch-item');
                const addresses = [];
                const amounts = [];
                
                for (let item of batchItems) {
                    const address = item.querySelector('.batch-address').value.trim();
                    const amount = item.querySelector('.batch-amount').value.trim();
                    
                    if (address && amount) {
                        if (!ethers.utils.isAddress(address)) {
                            showStatus('batchBurnStatus', 'error', `âŒ åœ°å€æ ¼å¼é”™è¯¯: ${address}`);
                            return;
                        }
                        
                        if (parseFloat(amount) <= 0) {
                            showStatus('batchBurnStatus', 'error', `âŒ æ•°é‡å¿…é¡»å¤§äº0: ${amount}`);
                            return;
                        }
                        
                        addresses.push(address);
                        amounts.push(ethers.utils.parseEther(amount));
                    }
                }
                
                if (addresses.length === 0) {
                    showStatus('batchBurnStatus', 'error', 'âŒ è¯·è‡³å°‘å¡«å†™ä¸€ä¸ªæœ‰æ•ˆçš„åœ°å€å’Œæ•°é‡');
                    return;
                }
                
                const totalAmount = amounts.reduce((sum, amt) => sum.add(amt), ethers.BigNumber.from(0));
                const totalFormatted = ethers.utils.formatEther(totalAmount);
                
                if (!confirm(`ç¡®è®¤è¦æ‰¹é‡é”€æ¯æ€»å…± ${totalFormatted} FMH ä»£å¸å—ï¼Ÿ\næ¶‰åŠ ${addresses.length} ä¸ªåœ°å€\n\nâš ï¸ æ­¤æ“ä½œä¸å¯æ’¤é”€ï¼`)) {
                    return;
                }
                
                showStatus('batchBurnStatus', 'warning', 'â³ æ­£åœ¨æ‰§è¡Œæ‰¹é‡é”€æ¯...');
                
                const tx = await contract.batchBurn(addresses, amounts);
                showStatus('batchBurnStatus', 'info', `â³ äº¤æ˜“å·²æäº¤ï¼Œç­‰å¾…ç¡®è®¤...<br><small>äº¤æ˜“å“ˆå¸Œ: ${tx.hash}</small>`);
                
                await tx.wait();
                showStatus('batchBurnStatus', 'success', `âœ… æ‰¹é‡é”€æ¯æˆåŠŸï¼<br>å…±é”€æ¯ ${totalFormatted} FMH (${addresses.length} ä¸ªåœ°å€)`);
                
                // æ¸…ç©ºæ‰¹é‡è¡¨å•
                document.querySelectorAll('.batch-address').forEach(input => input.value = '');
                document.querySelectorAll('.batch-amount').forEach(input => input.value = '');
                await refreshContractInfo();
                
            } catch (error) {
                console.error('æ‰¹é‡é”€æ¯å¤±è´¥:', error);
                showStatus('batchBurnStatus', 'error', `âŒ æ‰¹é‡é”€æ¯å¤±è´¥: ${error.message}`);
            }
        }
        
        // æ·»åŠ é“¸å¸è€…
        async function addMinter() {
            try {
                const minterAddress = document.getElementById('newMinterAddress').value.trim();
                
                if (!minterAddress || !ethers.utils.isAddress(minterAddress)) {
                    showStatus('minterStatus', 'error', 'âŒ è¯·è¾“å…¥æœ‰æ•ˆçš„åœ°å€');
                    return;
                }
                
                showStatus('minterStatus', 'info', 'â³ æ­£åœ¨æ·»åŠ é“¸å¸è€…...');
                
                const tx = await contract.addAuthorizedMinter(minterAddress);
                showStatus('minterStatus', 'info', `â³ äº¤æ˜“å·²æäº¤ï¼Œç­‰å¾…ç¡®è®¤...<br><small>äº¤æ˜“å“ˆå¸Œ: ${tx.hash}</small>`);
                
                await tx.wait();
                showStatus('minterStatus', 'success', `âœ… é“¸å¸è€…æ·»åŠ æˆåŠŸï¼<br>${minterAddress} ç°åœ¨æ‹¥æœ‰é“¸å¸æƒé™`);
                
                document.getElementById('newMinterAddress').value = '';
                
            } catch (error) {
                console.error('æ·»åŠ é“¸å¸è€…å¤±è´¥:', error);
                let errorMsg = 'âŒ æ·»åŠ é“¸å¸è€…å¤±è´¥: ';
                if (error.message.includes('Minter already authorized')) {
                    errorMsg += 'è¯¥åœ°å€å·²ç»æ˜¯é“¸å¸è€…';
                } else if (error.message.includes('Not authorized')) {
                    errorMsg += 'æ²¡æœ‰æƒé™æ‰§è¡Œæ­¤æ“ä½œ';
                } else {
                    errorMsg += error.message;
                }
                showStatus('minterStatus', 'error', errorMsg);
            }
        }
        
        // ç§»é™¤é“¸å¸è€…
        async function removeMinter() {
            try {
                const minterAddress = document.getElementById('removeMinterAddress').value.trim();
                
                if (!minterAddress || !ethers.utils.isAddress(minterAddress)) {
                    showStatus('minterStatus', 'error', 'âŒ è¯·è¾“å…¥æœ‰æ•ˆçš„åœ°å€');
                    return;
                }
                
                if (!confirm(`ç¡®è®¤è¦ç§»é™¤ ${minterAddress} çš„é“¸å¸æƒé™å—ï¼Ÿ`)) {
                    return;
                }
                
                showStatus('minterStatus', 'info', 'â³ æ­£åœ¨ç§»é™¤é“¸å¸è€…...');
                
                const tx = await contract.removeAuthorizedMinter(minterAddress);
                await tx.wait();
                
                showStatus('minterStatus', 'success', `âœ… é“¸å¸è€…ç§»é™¤æˆåŠŸï¼<br>${minterAddress} çš„é“¸å¸æƒé™å·²è¢«æ’¤é”€`);
                
                document.getElementById('removeMinterAddress').value = '';
                
            } catch (error) {
                console.error('ç§»é™¤é“¸å¸è€…å¤±è´¥:', error);
                let errorMsg = 'âŒ ç§»é™¤é“¸å¸è€…å¤±è´¥: ';
                if (error.message.includes('Minter not authorized')) {
                    errorMsg += 'è¯¥åœ°å€ä¸æ˜¯é“¸å¸è€…';
                } else if (error.message.includes('Not authorized')) {
                    errorMsg += 'æ²¡æœ‰æƒé™æ‰§è¡Œæ­¤æ“ä½œ';
                } else {
                    errorMsg += error.message;
                }
                showStatus('minterStatus', 'error', errorMsg);
            }
        }
        
        // æ£€æŸ¥é“¸å¸æƒé™
        async function checkMinterPermission() {
            try {
                const checkAddress = document.getElementById('checkMinterAddress').value.trim();
                
                if (!checkAddress || !ethers.utils.isAddress(checkAddress)) {
                    showStatus('minterStatus', 'error', 'âŒ è¯·è¾“å…¥æœ‰æ•ˆçš„åœ°å€');
                    return;
                }
                
                const [isMinter, isOwner] = await Promise.all([
                    contract.isAuthorizedMinter(checkAddress),
                    contract.isOwner(checkAddress)
                ]);
                
                let statusText = `ğŸ” æƒé™æŸ¥è¯¢ç»“æœ:<br><strong>åœ°å€:</strong> ${checkAddress}<br>`;
                statusText += `<strong>Owneræƒé™:</strong> ${isOwner ? 'âœ… æ˜¯' : 'âŒ å¦'}<br>`;
                statusText += `<strong>é“¸å¸æƒé™:</strong> ${isMinter ? 'âœ… æ˜¯' : 'âŒ å¦'}`;
                
                showStatus('minterStatus', 'info', statusText);
                
            } catch (error) {
                console.error('æƒé™æ£€æŸ¥å¤±è´¥:', error);
                showStatus('minterStatus', 'error', `âŒ æƒé™æ£€æŸ¥å¤±è´¥: ${error.message}`);
            }
        }
        
        // æŸ¥è¯¢ä½™é¢
        async function queryBalance() {
            try {
                const queryAddr = document.getElementById('queryAddress').value.trim();
                
                if (!queryAddr || !ethers.utils.isAddress(queryAddr)) {
                    showStatus('queryResults', 'error', 'âŒ è¯·è¾“å…¥æœ‰æ•ˆçš„åœ°å€');
                    return;
                }
                
                showLoading('queryResults');
                
                const balance = await contract.balanceOf(queryAddr);
                
                showStatus('queryResults', 'info', `ğŸ’° ä½™é¢æŸ¥è¯¢ç»“æœ:<br><strong>åœ°å€:</strong> ${queryAddr}<br><strong>FMHä½™é¢:</strong> ${formatToken(balance)}`);
                
            } catch (error) {
                console.error('ä½™é¢æŸ¥è¯¢å¤±è´¥:', error);
                showStatus('queryResults', 'error', `âŒ ä½™é¢æŸ¥è¯¢å¤±è´¥: ${error.message}`);
            }
        }
        
        // è·å–é”€æ¯ç‡
        async function getBurnRate() {
            try {
                showLoading('queryResults');
                
                const [totalSupply, totalBurned, burnRate] = await Promise.all([
                    contract.totalSupply(),
                    contract.getTotalBurned(),
                    contract.getBurnRate()
                ]);
                
                let resultText = `ğŸ“ˆ é”€æ¯ç»Ÿè®¡ä¿¡æ¯:<br>`;
                resultText += `<strong>æ€»ä¾›åº”é‡:</strong> ${formatToken(totalSupply)}<br>`;
                resultText += `<strong>å·²é”€æ¯æ•°é‡:</strong> ${formatToken(totalBurned)}<br>`;
                resultText += `<strong>é”€æ¯ç‡:</strong> ${(burnRate / 100).toFixed(2)}%`;
                
                showStatus('queryResults', 'info', resultText);
                
            } catch (error) {
                console.error('è·å–é”€æ¯ç‡å¤±è´¥:', error);
                showStatus('queryResults', 'error', `âŒ è·å–é”€æ¯ç‡å¤±è´¥: ${error.message}`);
            }
        }
        
        // è®¾ç½®æ¸¸æˆåˆçº¦
        async function setGameContract() {
            try {
                const gameAddress = document.getElementById('gameContractAddress').value.trim();
                
                if (!gameAddress || !ethers.utils.isAddress(gameAddress)) {
                    showStatus('settingsStatus', 'error', 'âŒ è¯·è¾“å…¥æœ‰æ•ˆçš„æ¸¸æˆåˆçº¦åœ°å€');
                    return;
                }
                
                if (!confirm(`ç¡®è®¤è¦è®¾ç½®æ¸¸æˆåˆçº¦åœ°å€ä¸º:\n${gameAddress}\n\nè¿™å°†å½±å“æ¸¸æˆç›¸å…³çš„ä»£å¸æ“ä½œã€‚`)) {
                    return;
                }
                
                showStatus('settingsStatus', 'info', 'â³ æ­£åœ¨æ›´æ–°æ¸¸æˆåˆçº¦åœ°å€...');
                
                const tx = await contract.setMinesweeperGame(gameAddress);
                showStatus('settingsStatus', 'info', `â³ äº¤æ˜“å·²æäº¤ï¼Œç­‰å¾…ç¡®è®¤...<br><small>äº¤æ˜“å“ˆå¸Œ: ${tx.hash}</small>`);
                
                await tx.wait();
                showStatus('settingsStatus', 'success', `âœ… æ¸¸æˆåˆçº¦åœ°å€è®¾ç½®æˆåŠŸï¼<br>æ–°åœ°å€: ${gameAddress}`);
                
                document.getElementById('gameContractAddress').value = '';
                await refreshContractInfo();
                
            } catch (error) {
                console.error('è®¾ç½®æ¸¸æˆåˆçº¦å¤±è´¥:', error);
                let errorMsg = 'âŒ è®¾ç½®æ¸¸æˆåˆçº¦å¤±è´¥: ';
                if (error.message.includes('Not authorized')) {
                    errorMsg += 'æ²¡æœ‰æƒé™æ‰§è¡Œæ­¤æ“ä½œ';
                } else {
                    errorMsg += error.message;
                }
                showStatus('settingsStatus', 'error', errorMsg);
            }
        }
        
        // æŸ¥è¯¢å½“å‰æ¸¸æˆåˆçº¦
        async function getCurrentGameContract() {
            try {
                showLoading('settingsStatus');
                
                const gameContract = await contract.minesweeperGame();
                
                let statusText = `ğŸ® å½“å‰æ¸¸æˆåˆçº¦ä¿¡æ¯:<br><strong>åœ°å€:</strong> `;
                if (gameContract === '0x0000000000000000000000000000000000000000') {
                    statusText += 'æœªè®¾ç½®æ¸¸æˆåˆçº¦';
                } else {
                    statusText += gameContract;
                }
                
                showStatus('settingsStatus', 'info', statusText);
                
            } catch (error) {
                console.error('æŸ¥è¯¢æ¸¸æˆåˆçº¦å¤±è´¥:', error);
                showStatus('settingsStatus', 'error', `âŒ æŸ¥è¯¢æ¸¸æˆåˆçº¦å¤±è´¥: ${error.message}`);
            }
        }
        
        // å·¥å…·å‡½æ•°
        function formatToken(amount) {
            try {
                return parseFloat(ethers.utils.formatEther(amount)).toLocaleString('zh-CN', {
                    minimumFractionDigits: 0,
                    maximumFractionDigits: 6
                });
            } catch {
                return '0';
            }
        }
        
        function showStatus(elementId, type, message) {
            const element = document.getElementById(elementId);
            if (element) {
                element.innerHTML = `<div class="status ${type}">${message}</div>`;
            }
        }
        
        function showLoading(elementId) {
            const element = document.getElementById(elementId);
            if (element) {
                element.innerHTML = `<div class="status info"><span class="loading"></span> æ­£åœ¨åŠ è½½...</div>`;
            }
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
        window.addEventListener('load', async () => {
            // æ£€æŸ¥ethers.jsæ˜¯å¦åŠ è½½
            let attempts = 0;
            const checkEthers = setInterval(() => {
                attempts++;
                if (typeof ethers !== 'undefined') {
                    clearInterval(checkEthers);
                    console.log('âœ… Ethers.js åŠ è½½å®Œæˆ');
                    
                    // å¦‚æœå·²ç»è¿æ¥è¿‡ï¼Œå°è¯•è‡ªåŠ¨é‡è¿
                    if (typeof window.ethereum !== 'undefined' && window.ethereum.selectedAddress) {
                        console.log('æ£€æµ‹åˆ°å·²è¿æ¥çš„é’±åŒ…ï¼Œå°è¯•è‡ªåŠ¨é‡è¿...');
                        // å¯é€‰æ‹©è‡ªåŠ¨é‡è¿
                    }
                } else if (attempts > 100) {
                    clearInterval(checkEthers);
                    showStatus('walletStatus', 'error', 'âŒ åŠ è½½ä¾èµ–å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•');
                }
            }, 100);
        });
        
        // ç›‘å¬é’±åŒ…è´¦æˆ·å˜åŒ–
        if (typeof window.ethereum !== 'undefined') {
            window.ethereum.on('accountsChanged', (accounts) => {
                if (accounts.length === 0) {
                    // ç”¨æˆ·æ–­å¼€è¿æ¥
                    location.reload();
                } else {
                    // ç”¨æˆ·åˆ‡æ¢è´¦æˆ·
                    location.reload();
                }
            });
            
            window.ethereum.on('chainChanged', (chainId) => {
                // ç½‘ç»œåˆ‡æ¢ï¼Œé‡æ–°åŠ è½½é¡µé¢
                location.reload();
            });
        }
    </script>
</body>
</html>